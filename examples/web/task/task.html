<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task</title>
    <script src="./../js/bundle.js"></script>
    <link rel="stylesheet" href="../css/main.css">
</head>
<body>
    <h1>Task API</h1>
    <div class="container">
        <div class="col-5">
            <h3>Credentials</h3>
            <div class="column">
                <div>
                    <label for="YAGNA_APPKEY">YAGNA_APPKEY: </label>
                    <input id="YAGNA_APPKEY" type="text" value=""/>
                </div>
                <div>
                    <label for="YAGNA_API_BASEPATH">YAGNA_API_BASEURL: </label>
                    <input id="YAGNA_API_BASEPATH" type="text" value="http://127.0.0.1:7465/" />
                </div>
            </div>
            <h3>Actions</h3>
            <div class="row vertical">
                <div>
                    <button onclick="run()">Run Task</button>
                </div>
            </div>
            <div class="results console">
                <h3>Results</h3>
                <ul id="results"></ul>
            </div>
        </div>
        <div class="col-7 border-left">
            <div class="logs console">
                <h3>Logs</h3>
                <ul id="logs"></ul>
            </div>
        </div>
    </div>

    <script>
        let activity;
        function appendLog(msg) {
            const logs_el = document.getElementById('logs');
            const li = document.createElement('li');
            li.appendChild(document.createTextNode(msg));
            logs_el.appendChild(li);
        }
        function appendResults(result) {
            const results_el = document.getElementById('results');
            const li = document.createElement('li');
            li.appendChild(document.createTextNode(result));
            results_el.appendChild(li);
        }
        const logger = {
            log: (msg) => appendLog(`[${new Date().toISOString()}] ${msg}`),
            warn: (msg) => appendLog(`[${new Date().toISOString()}] [warn] ${msg}`),
            debug: (msg) => appendLog(`[${new Date().toISOString()}] [debug] ${msg}`),
            error: (msg) => appendLog(`[${new Date().toISOString()}] [error] ${msg}`),
            info: (msg) => {
              console.log(msg);
              appendLog(`[${new Date().toISOString()}] [info] ${msg}`)
            },
        }
        async function run() {
            const appKey = document.getElementById('YAGNA_APPKEY').value;
            const basePath = document.getElementById('YAGNA_API_BASEPATH').value;
            console.log('creating executor...');
            const executor = await yajsapi
              .createExecutor({
                package:"9a3b5d67b0b27746283cb5f287c13eab1beaa12d92a9f536b747c7ae",
                logger
              })
              .catch(e => console.error(e));
            console.log('executor created');
            console.log({executor});
            console.log('run command...');
            await executor
              .run(async (ctx) => console.log((await ctx.run("echo 'Hello World'")).stdout))
              .catch(e => logger.error(e));
            await executor.end();

            // const executor = await yajsapi.createExecutor("9a3b5d67b0b27746283cb5f287c13eab1beaa12d92a9f536b747c7ae");
            // await executor.run(async (ctx) => console.log((await ctx.run("echo 'Hello World'")).stdout));
            // await executor.end();
        }
    </script>
</body>
</html>
